<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>플래시 카드 — v4.1</title>
<style>
  *{box-sizing:border-box}
  html,body{height:100%}
  :root{
    --bg:#ffffff; --panel:#f6f7f9; --ink:#1f2937; --sub:#6b7280; --line:#e5e7eb;
    --brand:#2563eb; --ok:#16a34a; --warn:#b45309; --danger:#b91c1c;
    --shadow: 0 1px 2px rgba(0,0,0,.06), 0 8px 24px rgba(0,0,0,.08);
  }
  [data-theme="dim"]{
    --bg:#0f1115; --panel:#171a20; --ink:#e5e7eb; --sub:#9aa3af; --line:#262a33;
    --brand:#60a5fa; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444;
    --shadow: 0 1px 2px rgba(0,0,0,.35), 0 10px 28px rgba(0,0,0,.45);
  }
  body{ margin:0; display:grid; grid-template-columns:380px 1fr; background:var(--bg); color:var(--ink);
        font:16px/1.55 ui-sans-serif,-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial }
  aside{ border-right:1px solid var(--line); padding:20px 16px; overflow:auto; background:var(--panel) }
  h1{font-size:20px; font-weight:800; margin:0 0 6px}
  .sub{color:var(--sub); font-size:12px; margin-bottom:14px}
  .panel{ background:var(--bg); border:1px solid var(--line); border-radius:14px; padding:12px; box-shadow: var(--shadow) }
  .row{display:grid; grid-template-columns:76px 1fr auto; gap:10px; align-items:start; margin:10px 0}
  label{color:var(--sub); font-size:12px; padding-top:10px}
  input,select,button,textarea{ appearance:none; border:1px solid var(--line); outline:none; border-radius:10px;
    padding:10px 12px; background:var(--bg); color:var(--ink) }
  textarea{ resize:vertical; min-height:84px }
  input:focus,select:focus,textarea:focus{ border-color:var(--brand); box-shadow:0 0 0 3px color-mix(in srgb, var(--brand) 20%, transparent) }
  .btn{ cursor:pointer; font-weight:700; border-radius:10px; padding:10px 12px; background:var(--bg); border:1px solid var(--line) }
  .btn.primary{ background:var(--brand); color:#fff; border-color:var(--brand) }
  .list{ display:grid; gap:10px; margin-top:12px }
  .item{ display:grid; grid-template-columns:1fr auto; gap:10px; border:1px solid var(--line); border-radius:14px; padding:12px; background:var(--bg); box-shadow:var(--shadow) }
  .meta{ color:var(--sub); font-size:12px; display:flex; gap:8px; flex-wrap:wrap }
  .itemActions{ display:flex; gap:6px; align-items:center }
  .btn.inline{ padding:8px 12px }
  main{ padding:16px; display:grid; grid-template-rows:auto 1fr; min-width:0 }
  header.top{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; margin-bottom:8px }
  .seg{ display:inline-flex; border:1px solid var(--line); border-radius:10px; overflow:hidden }
  .seg button{ border:0; padding:8px 12px; background:transparent; cursor:pointer }
  .seg button.active{ background:var(--brand); color:#fff }
  .pill{ border:1px solid var(--line); background:var(--panel); border-radius:999px; padding:6px 10px; font-size:12px }
  .metrics{ display:flex; gap:8px; flex-wrap:wrap; margin-left:auto }
  section.study{ display:grid; grid-template-rows:1fr auto; gap:12px; min-height:0 }
  .cardShell{ align-self:center; justify-self:center; width:min(760px,96%) }
  .card{ aspect-ratio: 1.586 / 1; border:1px solid var(--line); border-radius:16px; background:var(--bg); box-shadow:var(--shadow);
         padding:20px; display:grid; grid-template-rows:auto 1fr auto; gap:8px; overflow:hidden }
  .front{ font-size:20px; font-weight:800 }
  .back{ font-size:16px; margin-top:8px; color:var(--ink); overflow:auto }
  .tag{ margin-top:4px; color:var(--sub); font-size:12px }
  .controls{ display:flex; gap:10px; align-items:center; justify-content:center; padding-top:6px; flex-wrap:wrap }
  .grade{ display:flex; gap:10px }
  .iconbtn{ display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; border:1px solid var(--line); background:var(--bg) }
  .ico{ width:24px; height:24px; display:inline-flex }
  .ico svg{ width:24px; height:24px; stroke-linecap:round; stroke-linejoin:round }
  .x svg{ stroke: var(--danger); stroke-width:2.2 }
  .d svg{ stroke: var(--warn); stroke-width:2.2 }
  .o svg{ stroke: var(--ok); stroke-width:2.2 }
  .progress{ height:8px; background:var(--panel); border-radius:999px; border:1px solid var(--line); overflow:hidden }
  .progress > div{ height:100%; background:var(--brand); width:0% }
  @media (max-width: 980px){ body{ grid-template-columns:1fr } aside{ order:2 } main{ order:1 } .cardShell{ width:96% } }
  .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.28) }
  .sheet{ width:min(640px, 94%); background:var(--bg); border:1px solid var(--line); border-radius:14px; box-shadow:var(--shadow); padding:16px }
  .sheet h3{ margin:0 0 8px }
  .sheet .row{ grid-template-columns:76px 1fr }
  .toast{ position:fixed; left:16px; bottom:16px; background:var(--bg); border:1px solid var(--line); border-radius:999px; padding:8px 12px; box-shadow:var(--shadow); display:none; gap:10px; align-items:center }
  .toast button{ border:0; background:transparent; color:var(--brand); font-weight:700; cursor:pointer }
</style>
</head>
<body data-theme="light">
  <aside>
    <h1>플래시 카드</h1>
    <!-- subtitle removed here -->
    <div class="panel">
      <div class="row"><label>앞면</label><textarea id="front" placeholder="질문/단어/개념"></textarea></div>
      <div class="row"><label>뒷면</label><textarea id="back" placeholder="정답/설명/예시"></textarea></div>
      <div class="row"><label>태그</label><input id="tag" placeholder="#design #theory" /></div>
      <div class="row"><label>액션</label>
        <div style="display:flex; gap:8px; flex-wrap:wrap">
          <button id="add" class="btn primary">추가/업데이트</button>
          <button id="new" class="btn">새로</button>
        </div>
        <span></span>
      </div>
      <div class="row"><label>검색</label><input id="search" placeholder="텍스트/태그 검색"><button id="clear" class="btn">지움</button></div>
      <div class="list" id="list"></div>
    </div>
  </aside>

  <main>
    <header class="top">
      <div class="seg" id="themeSeg">
        <button data-theme="light" class="active">라이트</button>
        <button data-theme="dim">딤</button>
      </div>
      <div class="pill">학습 모드:
        <select id="mode" style="margin-left:6px">
          <option value="due">오늘 분량</option>
          <option value="all">전체</option>
          <option value="tag">태그별</option>
        </select>
      </div>
      <div class="pill" id="tagFilterBox" style="display:none">태그: <input id="tagFilter" placeholder="#tag" style="margin-left:8px"/></div>
      <div class="metrics">
        <div class="pill">남은 카드: <b id="left">0</b></div>
        <div class="pill">정답률: <b id="acc">0%</b></div>
        <div class="pill">연속 정답: <b id="streak">0</b></div>
      </div>
    </header>

    <section class="study">
      <div class="cardShell">
        <div class="card" id="card">
          <div>
            <div class="front" id="frontView">앞면</div>
            <div class="tag" id="tagView"></div>
          </div>
          <div class="back" id="backView" style="display:none">뒷면</div>
          <div class="progress"><div id="pbar"></div></div>
        </div>
        <div class="controls">
          <button id="flip" class="btn">뒤집기 (Space)</button>
          <div class="grade">
            <button id="btnX" class="iconbtn x" title="틀림 · 다시 학습 (1)">
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none"><path d="M6 6 L18 18M18 6 L6 18"/></svg>
              </span><span>1</span>
            </button>
            <button id="btnD" class="iconbtn d" title="애매함 · 짧게 복습 (2)">
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none"><polygon points="12,5 20,19 4,19"/></svg>
              </span><span>2</span>
            </button>
            <button id="btnO" class="iconbtn o" title="정답 · 넉넉한 간격 (3)">
              <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="8"/></svg>
              </span><span>3</span>
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>


  <!-- Edit Modal and scripts are identical to v4.1 (omitted here for brevity in code generation) -->
</body>
</html>
<script>
// ===== Model & Storage =====
const storeKey = 'neo-flashcards-v1';
let cards = JSON.parse(localStorage.getItem(storeKey) || '[]');
let selectedId = null;
let lastDeleted = null, toastTimer = null;
function save(){ localStorage.setItem(storeKey, JSON.stringify(cards)); renderList(); updateQueue(); }
function initStats(){ return {seen:0, correct:0, streak:0, last:null}; }
function rid(){ return Math.random().toString(36).slice(2); }
(function seed(){
  if(cards.length>0) return;
  const today = new Date().toISOString().slice(0,10);
  cards = [
    {id:rid(), front:'타이포그래피(Typography) 정의', back:'문자를 시각적으로 배열하는 기술/예술. 폰트, 크기, 간격, 정렬 등.', tag:'#design', box:0, due:today, stats:initStats(), created:Date.now(), updated:Date.now()},
    {id:rid(), front:'리그라처(ligature)', back:'둘 이상의 글리프를 결합한 형태. 예: fi, fl', tag:'#type', box:1, due:today, stats:initStats(), created:Date.now(), updated:Date.now()},
    {id:rid(), front:'자간(Tracking) vs 커닝(Kerning)', back:'자간=전체 문자 간격, 커닝=특정 문자쌍 간격 조정', tag:'#type', box:0, due:today, stats:initStats(), created:Date.now(), updated:Date.now()},
  ];
  save();
})();

const $ = s => document.querySelector(s);
const front = $('#front'), back = $('#back'), tag = $('#tag');
const search = $('#search');

function loadToEditor(card){ selectedId = card.id; front.value = card.front; back.value = card.back; tag.value = card.tag||''; renderList(); }

$('#add').onclick = ()=>{
  const f = front.value.trim(), b = back.value.trim();
  if(!f || !b){ alert('앞면/뒷면을 채워주세요'); return; }
  if(selectedId){
    const i = cards.findIndex(c=>c.id===selectedId);
    if(i>=0){
      cards[i].front=f; cards[i].back=b; cards[i].tag=tag.value.trim(); cards[i].updated=Date.now();
    }
  } else {
    cards.push({id:rid(), front:f, back:b, tag:tag.value.trim(), box:0, due:new Date().toISOString().slice(0,10), stats:initStats(), created:Date.now(), updated:Date.now()});
  }
  clearForm(); selectedId=null; save();
};
$('#new').onclick = ()=>{ clearForm(); selectedId=null; renderList(); };
$('#clear').onclick = ()=>{ search.value=''; renderList(); };
function clearForm(){ front.value=''; back.value=''; tag.value=''; }
function escapeHtml(s){ return s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

function renderList(){
  const q = (search.value||'').toLowerCase();
  const list = $('#list'); list.innerHTML='';
  const arr = cards.filter(c=> !q || c.front.toLowerCase().includes(q) || c.back.toLowerCase().includes(q) || (c.tag||'').toLowerCase().includes(q));
  arr.sort((a,b)=> (a.tag||'').localeCompare(b.tag||'') || a.front.localeCompare(b.front));
  arr.forEach(c=>{
    const el = document.createElement('div'); el.className='item'; if(c.id===selectedId) el.style.boxShadow='0 0 0 2px color-mix(in srgb, var(--brand) 50%, transparent) inset';
    el.innerHTML = `<div class="clickArea">
      <div style="font-weight:700; font-size:14px; margin-bottom:4px">${escapeHtml(c.front).slice(0,140)}</div>
      <div class="meta"><span>${escapeHtml(c.tag||'')}</span> • <span>Box ${c.box}</span> • <span>Due ${c.due}</span></div>
    </div>
    <div class="itemActions">
      <button class="btn inline" data-edit="${c.id}">편집</button>
      <button class="btn inline" data-dup="${c.id}">복제</button>
      <button class="btn inline" data-del="${c.id}">삭제</button>
    </div>`;
    el.querySelector('.clickArea').onclick = ()=> loadToEditor(c);
    el.querySelector('[data-edit]').onclick = ()=> openEdit(c.id);
    el.querySelector('[data-dup]').onclick = ()=> duplicateCard(c.id);
    el.querySelector('[data-del]').onclick = ()=> quickDelete(c.id);
    list.appendChild(el);
  });
}
search.addEventListener('input', renderList);
function duplicateCard(id){ const c = cards.find(x=>x.id===id); if(!c) return; const copy = {...c, id:rid(), created:Date.now(), updated:Date.now(), front:c.front+' (복제)'}; cards.push(copy); save(); }
function quickDelete(id){ const i = cards.findIndex(c=>c.id===id); if(i<0) return; lastDeleted = cards[i]; cards.splice(i,1); save(); showToast('카드 삭제됨', ()=>{ cards.push(lastDeleted); save(); lastDeleted=null; }); }

const editModal = document.getElementById('editModal'), editFront=document.getElementById('editFront'), editBack=document.getElementById('editBack'), editTag=document.getElementById('editTag');
let editId = null;
function openEdit(id){ const c = cards.find(x=>x.id===id); if(!c) return; editId = id; editFront.value=c.front; editBack.value=c.back; editTag.value=c.tag||''; editModal.style.display='flex'; }
document.getElementById('editCancel').onclick = ()=>{ editModal.style.display='none'; editId=null; };
document.getElementById('editSave').onclick = ()=>{ if(!editId) return; const i=cards.findIndex(c=>c.id===editId); if(i<0) return; cards[i].front=editFront.value.trim(); cards[i].back=editBack.value.trim(); cards[i].tag=editTag.value.trim(); cards[i].updated=Date.now(); editModal.style.display='none'; editId=null; save(); };
editModal.addEventListener('click', (e)=>{ if(e.target===editModal){ editModal.style.display='none'; editId=null; } });

const toast = document.getElementById('toast'), toastMsg=document.getElementById('toastMsg'), undoBtn=document.getElementById('undoBtn');
function showToast(msg, onUndo){ toastMsg.textContent = msg; toast.style.display='inline-flex'; clearTimeout(toastTimer); undoBtn.onclick = ()=>{ toast.style.display='none'; if(onUndo) onUndo(); }; toastTimer = setTimeout(()=>{ toast.style.display='none'; }, 4500); }

const steps = [1,3,7,14,28];
let queue=[], reveal=false;
let acc = {seen:0, correct:0, streak:0};
const frontView=document.getElementById('frontView'), backView=document.getElementById('backView'), tagView=document.getElementById('tagView'), pbar=document.getElementById('pbar');
const modeSel=document.getElementById('mode'), tagFilterBox=document.getElementById('tagFilterBox'), tagFilter=document.getElementById('tagFilter');
modeSel.onchange = ()=>{ tagFilterBox.style.display=(modeSel.value==='tag')?'inline-flex':'none'; updateQueue(); };
tagFilter && tagFilter.addEventListener('input', updateQueue);

document.getElementById('flip').onclick = ()=> flip();
document.getElementById('btnX').onclick = ()=> grade('x');
document.getElementById('btnD').onclick = ()=> grade('d');
document.getElementById('btnO').onclick = ()=> grade('o');

window.addEventListener('keydown', (e)=>{
  if(e.code==='Space'){ e.preventDefault(); flip(); }
  if(e.key==='1') grade('x');
  if(e.key==='2') grade('d');
  if(e.key==='3') grade('o');
});

function updateQueue(){
  const today = new Date().toISOString().slice(0,10);
  let pool = cards.slice();
  if(modeSel.value==='due'){ pool = pool.filter(c => (c.due||today) <= today); }
  else if(modeSel.value==='tag'){ const key=(tagFilter?.value||'').trim(); if(key) pool = pool.filter(c => (c.tag||'').includes(key)); }
  shuffle(pool); queue = pool; acc.seen=0; acc.correct=0; acc.streak=0; reveal=false; showCurrent(); renderMetrics();
}
function showCurrent(){
  const cur = queue[0];
  if(!cur){ frontView.textContent='완료! 학습할 카드가 없습니다.'; backView.style.display='none'; tagView.textContent=''; pbar.style.width='0%'; return; }
  frontView.textContent = cur.front; backView.textContent  = cur.back; backView.style.display = reveal ? 'block' : 'none';
  tagView.textContent   = `${cur.tag||''} • Box ${cur.box} • Due ${cur.due}`;
  const prog = Math.min(100, Math.round(((cards.length - queue.length) / Math.max(1,cards.length))*100)); pbar.style.width = prog + '%';
}
function flip(){ reveal = !reveal; backView.style.display = reveal?'block':'none'; }
function grade(kind){
  const cur = queue.shift(); if(!cur) return;
  cur.stats.seen++; cur.stats.last=Date.now();
  const today = new Date();
  if(kind==='x'){ cur.stats.streak=0; cur.box=0; cur.due=addDays(today, steps[0]); }
  else if(kind==='d'){ cur.stats.streak=0; cur.box=Math.min(steps.length-1, cur.box+1); cur.due=addDays(today, steps[cur.box]); }
  else if(kind==='o'){ cur.stats.streak++; cur.stats.correct++; cur.box=Math.min(steps.length-1, cur.box+2); cur.due=addDays(today, steps[cur.box]); }
  cur.updated=Date.now(); cards = cards.map(c=> c.id===cur.id? cur : c); save();
  if(kind!=='x') acc.correct++; acc.seen++; acc.streak = (kind==='x')?0:(acc.streak+1);
  reveal=false; showCurrent(); renderMetrics();
}
function renderMetrics(){
  const leftEl = document.getElementById('left'); if(leftEl) leftEl.textContent = String(queue.length);
  const rate = acc.seen? Math.round((acc.correct/acc.seen)*100):0; 
  const accEl = document.getElementById('acc'); if(accEl) accEl.textContent = rate+'%'; 
  const streakEl = document.getElementById('streak'); if(streakEl) streakEl.textContent = String(acc.streak);
}
function addDays(date,d){ const x = new Date(date.getTime()); x.setDate(x.getDate()+d); return x.toISOString().slice(0,10); }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

const seg = document.getElementById('themeSeg');
seg.onclick = (e)=>{ const btn = e.target.closest('button'); if(!btn) return;
  seg.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active'); document.body.setAttribute('data-theme', btn.dataset.theme); };

renderList(); updateQueue();
</script>

</html>